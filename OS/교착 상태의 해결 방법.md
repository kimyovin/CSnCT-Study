# 1. 교착 상태의 발생 조건

1. **상호배제(Mutual Exclusion)**  
→ 하나의 자원에 대한 여러 프로세스의 동시 접근 불가

2. **점유와 대기(Hold and Wait)**  
→ 자원을 가지고(점유) 있을 때 다른 프로세스가 사용하는 자원의 반납을 기다리는 것(대기)

3. **비선점(Non-preemption)**  
→ 다른 프로세스의 자원을 강제로 빼앗을 수 없음

4. **순환(환형) 대기(Circular Wait)**  
→ 각 프로세스가 순환적으로 다음 프로세스가 요구하는 자원을 가지고 있는 것

# 2. 교착 상태의 해결 방법

**1. 예방(Prevention)**
- 교착상태의 4가지 발생 조건 중 하나라도 막아 교착상태가 발생하지 않게 하는 방법

**2. 회피(Avoidance)**
- 교착 상태의 발생조건을 막는 것이 아니라, 발생하지 않도록 알고리즘을 적용시키는 방법

**3. 회복(Recovery)**
- 교착상태가 되는 것을 허용시켜 교착상태가 탐지되면 이후에 해결방법

# 2-1. 교착 상태 예방

교착 상태의 조건 중 하나를 막아 교착 상태 자체를 생기지 않게 예방한다. 

이는 장치의 효율성과 시스템 처리량을 떨어뜨린다.

## 1) 상호 배제 부정

공유불가능한 자원에 여러 프로세스가 동시에 접근하면 교착 상태가 생기므로 `공유불가능한 자원`을 없앤다.

- 즉, 공유 자원만을 사용한다.

- 하지만 모든 자원을 공유자원으로 사용할 수 없으므로 현실적으로 불가능하다.

## 2) 점유와 대기 조건 부정

프로세스가 작업에 **필요한 자원을 모두 할당받아** 대기 상태를 막는다.

- 방법 1. 필요한 모든 자원을 한번에 할당받아 실행한다. (대기 조건 방지)

- 방법 2. 프로세스가 자원을 점유하고 있지 않을 때만 자원을 요구한다. (점유 시 자원 요청을 하지 않는다.)

- 단점
    - 자원의 효율성이 낮다.
      - 많은 자원이 사용시간에 비해 할당된 시간이 길어진다.

    - 기아 상태가 발생할 수 있다.
      - 자주 사용되는 요청 자원의 수가 많은 경우, 무한정 기다려야 하는 경우가 발생하다.

## 3) 비선점 조건 부정

자원을 점유하고 있는 프로세스가  
다른 자원을 요구할 때 점유하고 있는 자원을 **반납**하고,  
요구한 자원을 사용하기 위해 **기다리게 한다.**

- 기다림이 끝나고 프로세스가 재시작을 할 때, 해제한 자원과 새로운 자원을 확보해야한다.

- 따라서 이미 실행한 작업의 상태를 읽을 수도 있다.

## 4) 순환 대기 조건 부정

모든 자원에 일련의 순서를 부여하여 각 프로세스가 현재 점유한 자원을 기준으로 한 쪽 방향으로만 자원을 요구할 수 있게 한다.

- 예시

    - 오름차순으로만 자원 요청 가능한 상황, 한 프로세스가 프린터(자원번호 2), 디스크 드라이브(자원번호 5)를 동시에 사용한다면

    - R2인 프린터 요청 후, R5인 디스크 드라이브를 요청한다.

# 2-2. 교착 상태 회피

교착 상태를 막지 않고 교착상태가 발생하려고 할 때, 알고리즘을 사용하여 적절히 제어하여 피한다.

## 1) 프로세스 시작 중단

프로세스의 자원 요구가 교착 상태를 발생시킬 수 있다면 프로세스 시작을 즉시 중단한다.

## 2) 자원 할당 거부

**은행가 알고리즘**이라고 하며, 

프로세스의 자원 요구가 교착 상태를 발생시킬 수 있다면 요청한 자원을 할당하지 않는다.

### 은행가 알고리즘

- 다익스트라가 제안한 기법

- 자원을 할당하기 전에 미리 결정된 모든 자원의 최대 가능한 할당량을 시뮬레이션하여 안전 여부를 검사한다.

- 안정 상태를 유지할 수 있는 요구만 수락하고 불안정 상태를 초래할 프로세스의 요구는 나중에 만족될 수 있을 때까지 거절한다.

# 2-3. 교착 상태 회복

**시스템 상태를 검사하는 알고리즘**과 **교착상태에서 회복시키는 알고리즘**이 필요하다.

교착 상태가 되면 교착 상태를 유발한 **프로세스를 중단**시키는 방법과 교착 상태 프로세스에 할당된 **자원을 선점**하여 회복할 수 있다.

## 프로세스 중단

- 교착 상태 프로세스를 모두 중단한다.

- 교착 상태 프로세스 중 하나씩 골라 중단시킨다.
    - 기준)
    - 우선순위가 낮은 프로세스
    - 작업 시간이 짧은 프로세스
    - 자원을 많이 사용하는 프로세스를 먼저 종료한다.

## 자원 선점

- 교착상태의 프로세스가 점유하고 있는 자원을 선점하여 다른 프로세스에게 할당한다.

- 자원 선점 시 주의 사항

    **1. 자원을 선점할 프로세스 선택 문제** : 점유 자원 수, 소요된 실행 시간를 고려하여 최소의 비용을 줄 수 있는 프로세스를 선택한다.

    **2. 복귀 문제** : 필요한 자원을 잃은 프로세스는 정상적으로 실행할 수 없으므로 교착상태의 프로세스를 중단시킨 후 다시 시작시킨다.

    **3. 기아 현상 문제** : 희생되는 프로세스가 동일한 프로세스로 지정되지 않게 프로세스 비용 요소에 복귀 횟수를 포함시켜 고려해야한다. 
