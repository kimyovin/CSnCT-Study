# 페이지 대치 알고리즘
페이지 부재가 일어나 메인 메모리의 프레임이 다 찼을 경우, **교체할 프레임을 선택하는 알고리즘**

- FIFO 교체 알고리즘
- 최적 페이지 교체 알고리즘 (OPT)
- 최근 최소 사용 교체 알고리즘 (LRU)
- 최근 최소 사용 근접 알고리즘 이 있다.

## 선입선출 교체 알고리즘(FIFO)

가장 오래된 페이지를 교체한다.

- 페이지가 들어온 시간을 이용하여 올라온 순서를 queue 구조로 유지한다.
- (장점) 오버헤드가 적고 가장 간단하며 구현이 쉽다.
- (단점) 활발히 사용 중인 페이지를 계속 교체하면 페이지 부채율이 높아져 성능이 떨어질 수 있다.

### 예시

<p align="center">
  <img src="https://github.com/triflingness/CSnCT-Study/blob/761b85d04b8f37153f5d54e30c5594dd89ebf9aa/OS/imgs/%E1%84%91%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%8C%E1%85%B5%20%E1%84%83%E1%85%A2%E1%84%8E%E1%85%B5%20%E1%84%8B%E1%85%A1%E1%86%AF%E1%84%80%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8C%E1%85%B3%E1%86%B7/FIFO.png" width="900">
</p>

① 처음에는 프레임 3개가 비어 있다.

② 1, 2, 3 참조 문자열 3개가 페이지 부재를 일으켜 빈 프레임에 할당된다.

③ 다음 참조 문자열 2, 1은 메모리에 이미 있으므로 페이지 부재가 발생하지 않는다.

④ 참조 문자열 5가 처음 들어왔던 페이지 1을 대치 한다.

⑤ 참조 문자열 2는 이미 메모리에 있으므로 페이지 부재가 발생하지 않는다.

⑥ 참조 문자열 1이 페이지 2를 대치한다. (5, 2, 3 중 2가 가정 먼저 들어왔기 때문에 희생)

⑦ 참조 문자열 6이 페이지 3를 대치한다. (5, 1, 3 중 3이 가정 먼저 들어왔기 때문에 희생)

이 과장을 계속 진행하면 총 열네(14)번의 페이지 부재가 발생한다.

### 벨래디의 변이(Belady's anomaly)

'할당하는 프레임 수가 증가하면 페이지 부재 비율도 증가하는 현상'

→ 즉, Frame을 많이 할당했음에도 오히려 페이지 부재가 더 일어나는 이상현상

<p align="center">
  <img src="https://github.com/triflingness/CSnCT-Study/blob/761b85d04b8f37153f5d54e30c5594dd89ebf9aa/OS/imgs/%E1%84%91%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%8C%E1%85%B5%20%E1%84%83%E1%85%A2%E1%84%8E%E1%85%B5%20%E1%84%8B%E1%85%A1%E1%86%AF%E1%84%80%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8C%E1%85%B3%E1%86%B7/%E1%84%87%E1%85%A6%E1%86%AF%E1%84%85%E1%85%A2%E1%84%83%E1%85%B5%E1%84%8B%E1%85%B4%20%E1%84%87%E1%85%A7%E1%86%AB%E1%84%8B%E1%85%B5.png">
</p>

- FIFO 교체 알고리즘을 사용할 경우, 벨래디 변이 현상이 일어난다.
    - FIFO 교체 알고리즘을 사용하여 프레임을 많이 할당하면 페이지 부재가 많이 일어난다.

## 최적 페이지 교체 알고리즘(OPT)

> OPT, OPTimal replacement algorithm

가장 오랫동안 사용하지 않을 페이지를 교체한다.

- 모든 알고리즘 중 페이지 부재 비율이 가장 낮다.
- 현실적으로 어떤 페이지가 오래 사용하지 않을 것인지 알기 어렵다. → 구현이 어렵다.
- 최소작업 우선(Shortest Job First)스케줄링과 비슷하다.

## 최근 최소 사용 교체 알고리즘(LRU)

> LRU, Least Recently Used

**최근에 사용하지 않은 페이지를 가장 먼저 교체**한다.

→ **메모리 지역성**을 이용

- 카운터 또는 스택과 같은 별도의 하드웨어를 이용한다.
- 최적 알고리즘과 가장 가깝다.
- 많은 운영체제가 채택하고 좋은 알고리즘이라 평가된다.

<p>
  <img src="https://github.com/triflingness/CSnCT-Study/blob/761b85d04b8f37153f5d54e30c5594dd89ebf9aa/OS/imgs/%E1%84%91%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%8C%E1%85%B5%20%E1%84%83%E1%85%A2%E1%84%8E%E1%85%B5%20%E1%84%8B%E1%85%A1%E1%86%AF%E1%84%80%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8C%E1%85%B3%E1%86%B7/LRU.png" widht="700">
</p>

# 최근 최소 사용 근접 알고리즘

최근 최소 사용 알고리즘의 하드웨어 지원이 안 될 경우, **참조 비트**의 형태를 사용한다.

- NUR 알고리즘 (Not Used Recently)
- LFU 알고리즘 (Least Frequently Used)
- MFU 알고리즘 (Most Frequently Used)
- 페이지 버퍼링 (Page Buffering)

## NUR 알고리즘

> NUR, Not Used Recently

최근 사용하지 않는 페이지를 교체한다.

## LFU 알고리즘 (최소 사용 빈도수)

> LFU, Least Frequently Used

**참조 횟수 값이 가장 작은 페이지를 교체**한다.

- 각 페이지마다 참조 횟수 카운터가 있다.
    - 초기에 많이 사용하였지만 이제 더이상 필요하지 않을 경우에도 메모리에 남아있게 되는 현상을 볼 수 있다.

## MFU 알고리즘 (최대 사용 빈도수)

> MFU, Most Frequently Used

**참조 횟수 값이 가장 큰 페이지를 교체**한다.

- 방금 들어와서 아직 사용되지 않았기에 앞으로 더 사용할 확률이 높다고 가정한다.

## 페이지 버퍼링

> Page Buffering

선입선출 알고리즘에서 교체 대상으로 선택한 페이지를 즉시 교체하지 않고 잠시 버퍼에 넣어 보관한다.

- 교체가 되고 얼마되지않아 다시 사용될 수 있으니 메모리에 잠시 버퍼링해 놓는다.

# 프레임 할당 알고리즘

프로세스 여러개가 동시에 수행되는 상황에서 각 프로세스에게 얼마만큼의 메모리 공간을 할당할 것인지를 결정해야 한다.

## 균일 프레임 할당 알고리즘

각 프로세스에게 **똑같은 프레임 수를 할당**하는 방법

- 프레임 수가 `m`개를 프로세스 `n`개에게 나눠주는 가장 쉬운 방법

    → 프로세스 1개 당 `m / n` 개씩 할당해준다.

- 각 프로세스가 요구하는 메모리 양이 서로 다르기 때문에 **프레임 낭비, 빈번한 페이지 부재**가 일어날 수 있다.

## 비례 프레임 할당 알고리즘

각 프로세스의 **크기에 비례하여 프레임 수를 할당**하는 방법

→ **많은 메모리를 요구하는 프로세스는** 적은 메모리를 요구하는 프로세스보다 **더 많은 페이지 프레임을 할당받는다!**

<p>
  <img src="https://github.com/triflingness/CSnCT-Study/blob/761b85d04b8f37153f5d54e30c5594dd89ebf9aa/OS/imgs/%E1%84%91%E1%85%A6%E1%84%8B%E1%85%B5%E1%84%8C%E1%85%B5%20%E1%84%83%E1%85%A2%E1%84%8E%E1%85%B5%20%E1%84%8B%E1%85%A1%E1%86%AF%E1%84%80%E1%85%A9%E1%84%85%E1%85%B5%E1%84%8C%E1%85%B3%E1%86%B7/%E1%84%87%E1%85%B5%E1%84%85%E1%85%A8%20%E1%84%91%E1%85%B3%E1%84%85%E1%85%A6%E1%84%8B%E1%85%B5%E1%86%B7%20%E1%84%92%E1%85%A1%E1%86%AF%E1%84%83%E1%85%A1%E1%86%BC.png" width="700">
</p>

**예시)**

```
  - 메인 메모리의 프레임 개수 `m` =  62개

  - 일반 프로그램) 페이지 개수 `s` = 10개

  - 대화식 데이터베이스) 페이지 개수 `s` = 127개

→ 일반 프로그램의 할당 프레임 수) `10 / 137 x 62 ⇒ 4`

→ 대화식 데이터베이스의 할당 프레임 수) `127 / 137 x 62 ⇒ 57`
```

----

🖍 현재 운영체제는 균일 할당 방식과 비례 할당 방식을 혼합하여 이용한다.
